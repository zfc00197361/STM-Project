\hypertarget{class_t_m}{}\subsection{TM Class Reference}
\label{class_t_m}\index{TM@{TM}}


{\ttfamily \#include $<$T\+M.\+h$>$}



Collaboration diagram for TM\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=208pt]{class_t_m__coll__graph}
\end{center}
\end{figure}
\subsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
std\+::shared\+\_\+ptr$<$ \hyperlink{class_t_x}{TX} $>$ const \hyperlink{class_t_m_a41cb0226cc4080c931651b13f74a0075_a41cb0226cc4080c931651b13f74a0075}{\+\_\+get\+\_\+tx} ()
\begin{DoxyCompactList}\small\item\em \+\_\+get\+\_\+tx std\+::shared\+\_\+ptr$<$\+T\+X$>$, returning a shared pointer with the transaction \end{DoxyCompactList}\item 
void \hyperlink{class_t_m_a5e2d1127f2429f2f524d25f430eade06_a5e2d1127f2429f2f524d25f430eade06}{\+\_\+\+T\+X\+\_\+\+E\+X\+IT} ()
\begin{DoxyCompactList}\small\item\em \+\_\+\+T\+X\+\_\+\+E\+X\+IT void, the thread calls the ostm\+\_\+exit function in the transaction, and clear all elements from the shared global collection associated with the main process \end{DoxyCompactList}\item 
std\+::map$<$ std\+::thread\+::id, int $>$ \hyperlink{class_t_m_afb8bc9f42fe06c52747beb7f4c46915c_afb8bc9f42fe06c52747beb7f4c46915c}{get\+\_\+thread\+\_\+\+Map} ()
\begin{DoxyCompactList}\small\item\em get\+\_\+thread\+\_\+\+Map std\+::map, returning a map to store all unique ID from all objects from all transactions within the main process \end{DoxyCompactList}\item 
bool \hyperlink{class_t_m_a3285005a8f3e9fed99b024dac86fae05_a3285005a8f3e9fed99b024dac86fae05}{operator==} (const \hyperlink{class_t_m}{TM} \&rhs) const 
\item 
void \hyperlink{class_t_m_a1d6891b1d3e71cc0acef54e7afe71c09_a1d6891b1d3e71cc0acef54e7afe71c09}{print\+\_\+all} ()
\begin{DoxyCompactList}\small\item\em O\+N\+LY F\+OR T\+E\+S\+T\+I\+NG print\+\_\+all void, print out all object key from tx\+M\+AP collection. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsubsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static \hyperlink{class_t_m}{TM} \& \hyperlink{class_t_m_a7ce5f35e0dae76df4fe116cf905bbe60_a7ce5f35e0dae76df4fe116cf905bbe60}{Instance} ()
\begin{DoxyCompactList}\small\item\em Scott Meyer\textquotesingle{}s Singleton creation, what is thread safe. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsubsection*{Private Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{class_t_m}{TM} \& \hyperlink{class_t_m_a85a6b783f0566f0877bab6a7de977c0a_a85a6b783f0566f0877bab6a7de977c0a}{operator=} (const \hyperlink{class_t_m}{TM} \&)=delete
\begin{DoxyCompactList}\small\item\em \hyperlink{class_t_m}{TM} copy operator, prevent from copying the Transaction Manager. \end{DoxyCompactList}\item 
void \hyperlink{class_t_m_a26ea481c24d9aa3aebd6dafb7253376e_a26ea481c24d9aa3aebd6dafb7253376e}{register\+TX} ()
\begin{DoxyCompactList}\small\item\em get\+\_\+thread\+\_\+\+Map returning and map to insert to the process\+\_\+map\+\_\+collection as an inner value \end{DoxyCompactList}\item 
\hyperlink{class_t_m_a9b5afb6b9d7c5925ab5cc5c65078ac23_a9b5afb6b9d7c5925ab5cc5c65078ac23}{TM} ()=default
\begin{DoxyCompactList}\small\item\em \hyperlink{class_t_m}{TM} constructor, prevent from multiple instantiation. \end{DoxyCompactList}\item 
\hyperlink{class_t_m_a466fc96ad2e1c681e178e3b58310f87c_a466fc96ad2e1c681e178e3b58310f87c}{TM} (const \hyperlink{class_t_m}{TM} \&)
\begin{DoxyCompactList}\small\item\em \hyperlink{class_t_m}{TM} copy constructor, prevent from copying the Transaction Manager. \end{DoxyCompactList}\item 
\hyperlink{class_t_m_a985f8cb24f685925ddd637c7030cd2b3_a985f8cb24f685925ddd637c7030cd2b3}{$\sim$\+TM} ()=default
\begin{DoxyCompactList}\small\item\em \hyperlink{class_t_m}{TM} de-\/constructor, prevent from deletion. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsubsection*{Private Attributes}
\begin{DoxyCompactItemize}
\item 
std\+::mutex \hyperlink{class_t_m_a123bc5aa0766a7b909bebc54a429e5b0_a123bc5aa0766a7b909bebc54a429e5b0}{get\+\_\+\+Lock}
\item 
std\+::mutex \hyperlink{class_t_m_aeb26546681bfe64e21606b8c012bb8c3_aeb26546681bfe64e21606b8c012bb8c3}{register\+\_\+\+Lock}
\item 
std\+::map$<$ std\+::thread\+::id, std\+::shared\+\_\+ptr$<$ \hyperlink{class_t_x}{TX} $>$ $>$ \hyperlink{class_t_m_a0333dfa193ea99d7626de74a2b932e9b_a0333dfa193ea99d7626de74a2b932e9b}{tx\+Map}
\end{DoxyCompactItemize}
\subsubsection*{Static Private Attributes}
\begin{DoxyCompactItemize}
\item 
static pid\+\_\+t \hyperlink{class_t_m_a6fb90615393f9205838e302c714bbd60_a6fb90615393f9205838e302c714bbd60}{\+\_\+tm\+\_\+id}
\item 
static std\+::map$<$ pid\+\_\+t, std\+::map$<$ std\+::thread\+::id, int $>$ $>$ \hyperlink{class_t_m_a81c3bd28ad2343a620fa070f8ac186ca_a81c3bd28ad2343a620fa070f8ac186ca}{process\+\_\+map\+\_\+collection}
\begin{DoxyCompactList}\small\item\em S\+T\+A\+T\+IC G\+L\+O\+B\+AL M\+AP Collection to store all process associated keys to find when deleting transactions. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsubsection{Detailed Description}


Definition at line \hyperlink{_t_m_8h_source_l00021}{21} of file \hyperlink{_t_m_8h_source}{T\+M.\+h}.



\subsubsection{Constructor \& Destructor Documentation}
\index{TM@{TM}!TM@{TM}}
\index{TM@{TM}!TM@{TM}}
\paragraph[{\texorpdfstring{T\+M()=default}{TM()=default}}]{\setlength{\rightskip}{0pt plus 5cm}T\+M\+::\+TM (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}, {\ttfamily [default]}}\hypertarget{class_t_m_a9b5afb6b9d7c5925ab5cc5c65078ac23_a9b5afb6b9d7c5925ab5cc5c65078ac23}{}\label{class_t_m_a9b5afb6b9d7c5925ab5cc5c65078ac23_a9b5afb6b9d7c5925ab5cc5c65078ac23}


\hyperlink{class_t_m}{TM} constructor, prevent from multiple instantiation. 

\index{TM@{TM}!````~TM@{$\sim$\+TM}}
\index{````~TM@{$\sim$\+TM}!TM@{TM}}
\paragraph[{\texorpdfstring{$\sim$\+T\+M()=default}{~TM()=default}}]{\setlength{\rightskip}{0pt plus 5cm}T\+M\+::$\sim$\+TM (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}, {\ttfamily [default]}}\hypertarget{class_t_m_a985f8cb24f685925ddd637c7030cd2b3_a985f8cb24f685925ddd637c7030cd2b3}{}\label{class_t_m_a985f8cb24f685925ddd637c7030cd2b3_a985f8cb24f685925ddd637c7030cd2b3}


\hyperlink{class_t_m}{TM} de-\/constructor, prevent from deletion. 

\index{TM@{TM}!TM@{TM}}
\index{TM@{TM}!TM@{TM}}
\paragraph[{\texorpdfstring{T\+M(const T\+M \&)}{TM(const TM &)}}]{\setlength{\rightskip}{0pt plus 5cm}T\+M\+::\+TM (
\begin{DoxyParamCaption}
\item[{const {\bf TM} \&}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}\hypertarget{class_t_m_a466fc96ad2e1c681e178e3b58310f87c_a466fc96ad2e1c681e178e3b58310f87c}{}\label{class_t_m_a466fc96ad2e1c681e178e3b58310f87c_a466fc96ad2e1c681e178e3b58310f87c}


\hyperlink{class_t_m}{TM} copy constructor, prevent from copying the Transaction Manager. 



\subsubsection{Member Function Documentation}
\index{TM@{TM}!\+\_\+get\+\_\+tx@{\+\_\+get\+\_\+tx}}
\index{\+\_\+get\+\_\+tx@{\+\_\+get\+\_\+tx}!TM@{TM}}
\paragraph[{\texorpdfstring{\+\_\+get\+\_\+tx()}{_get_tx()}}]{\setlength{\rightskip}{0pt plus 5cm}std\+::shared\+\_\+ptr$<$ {\bf TX} $>$ const T\+M\+::\+\_\+get\+\_\+tx (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\hypertarget{class_t_m_a41cb0226cc4080c931651b13f74a0075_a41cb0226cc4080c931651b13f74a0075}{}\label{class_t_m_a41cb0226cc4080c931651b13f74a0075_a41cb0226cc4080c931651b13f74a0075}


\+\_\+get\+\_\+tx std\+::shared\+\_\+ptr$<$\+T\+X$>$, returning a shared pointer with the transaction 

\+\_\+get\+\_\+tx std\+::shared\+\_\+ptr$<$\+T\+X$>$, return a shared\+\_\+ptr with the Transaction object, if \hyperlink{class_t_x}{TX} not exists then create one, else increasing the nesting level  std\+::mutex, protect shared collection from critical section


\begin{DoxyParams}{Parameters}
{\em guard} & std\+::lock\+\_\+guard, locks the register\+\_\+\+Lock mutex, unlock automatically when goes out of the scope \\
\hline
\end{DoxyParams}


Definition at line \hyperlink{_t_m_8cpp_source_l00079}{79} of file \hyperlink{_t_m_8cpp_source}{T\+M.\+cpp}.



References \hyperlink{_t_m_8h_source_l00063}{get\+\_\+\+Lock}, \hyperlink{_t_m_8cpp_source_l00043}{register\+T\+X()}, and \hyperlink{_t_m_8h_source_l00042}{tx\+Map}.



Referenced by \hyperlink{_my_test_c_ase_8cpp_source_l00020}{My\+Test\+C\+Ase\+::\+\_\+collection\+\_\+bject\+\_\+()}, \hyperlink{_my_test_c_ase_8cpp_source_l00126}{My\+Test\+C\+Ase\+::\+\_\+complex\+\_\+transfer\+\_\+()}, \hyperlink{client_8h_source_l00236}{client\+::\+\_\+complex\+\_\+transfer\+\_\+()}, \hyperlink{client_8h_source_l00089}{client\+::\+\_\+nesting\+\_\+()}, \hyperlink{_my_test_c_ase_8cpp_source_l00320}{My\+Test\+C\+Ase\+::\+\_\+nesting\+\_\+()}, \hyperlink{_my_test_c_ase_8cpp_source_l00074}{My\+Test\+C\+Ase\+::\+\_\+one\+\_\+account\+\_\+transfer\+\_\+()}, \hyperlink{_my_test_c_ase_8cpp_source_l00194}{My\+Test\+C\+Ase\+::\+\_\+six\+\_\+account\+\_\+transfer\+\_\+()}, \hyperlink{client_8h_source_l00170}{client\+::\+\_\+six\+\_\+account\+\_\+transfer\+\_\+()}, \hyperlink{client_8h_source_l00041}{client\+::\+\_\+two\+\_\+account\+\_\+transfer\+\_\+()}, \hyperlink{_my_test_c_ase_8cpp_source_l00266}{My\+Test\+C\+Ase\+::\+\_\+two\+\_\+account\+\_\+transfer\+\_\+()}, \hyperlink{_my_test_c_ase_8cpp_source_l00853}{My\+Test\+C\+Ase\+::decrease\+\_\+nesting()}, \hyperlink{_my_test_c_ase_8cpp_source_l00881}{My\+Test\+C\+Ase\+::decrease\+\_\+nesting\+\_\+fail()}, \hyperlink{_my_test_c_ase_8cpp_source_l00841}{My\+Test\+C\+Ase\+::increase\+\_\+nesting()}, \hyperlink{_my_test_c_ase_8cpp_source_l00868}{My\+Test\+C\+Ase\+::increase\+\_\+nesting\+\_\+fail()}, \hyperlink{_my_test_c_ase_8cpp_source_l00818}{My\+Test\+C\+Ase\+::object\+\_\+not\+\_\+registered\+\_\+throw\+\_\+runtime\+\_\+error()}, \hyperlink{_my_test_c_ase_8cpp_source_l00805}{My\+Test\+C\+Ase\+::register\+\_\+null\+\_\+pointer\+\_\+throw\+\_\+runtime\+\_\+error()}, and \hyperlink{_my_test_c_ase_8cpp_source_l00831}{My\+Test\+C\+Ase\+::store\+\_\+null\+\_\+pointer\+\_\+throw\+\_\+runtime\+\_\+error()}.


\begin{DoxyCode}
00080 \{
00081     std::lock\_guard<std::mutex> guard(\hyperlink{class_t_m_a123bc5aa0766a7b909bebc54a429e5b0_a123bc5aa0766a7b909bebc54a429e5b0}{get\_Lock});
00082 
00083     std::map<std::thread::id, std::shared\_ptr<TX>>::iterator it = \hyperlink{class_t_m_a0333dfa193ea99d7626de74a2b932e9b_a0333dfa193ea99d7626de74a2b932e9b}{txMap}.find(std::this\_thread::get\_id(
      ));
00084     \textcolor{keywordflow}{if}(it == \hyperlink{class_t_m_a0333dfa193ea99d7626de74a2b932e9b_a0333dfa193ea99d7626de74a2b932e9b}{txMap}.end())
00085     \{
00086        \hyperlink{class_t_m_a26ea481c24d9aa3aebd6dafb7253376e_a26ea481c24d9aa3aebd6dafb7253376e}{registerTX}();
00087        it = \hyperlink{class_t_m_a0333dfa193ea99d7626de74a2b932e9b_a0333dfa193ea99d7626de74a2b932e9b}{txMap}.find(std::this\_thread::get\_id());
00088        
00089     \} \textcolor{keywordflow}{else} \{
00090         it->second->\_increase\_tx\_nesting();
00091     \}
00092     \textcolor{comment}{//it = txMap.find(std::this\_thread::get\_id());}
00093     
00094 
00095     \textcolor{keywordflow}{return} it->second;
00096 
00097 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{class_t_m_a41cb0226cc4080c931651b13f74a0075_a41cb0226cc4080c931651b13f74a0075_cgraph}
\end{center}
\end{figure}


\index{TM@{TM}!\+\_\+\+T\+X\+\_\+\+E\+X\+IT@{\+\_\+\+T\+X\+\_\+\+E\+X\+IT}}
\index{\+\_\+\+T\+X\+\_\+\+E\+X\+IT@{\+\_\+\+T\+X\+\_\+\+E\+X\+IT}!TM@{TM}}
\paragraph[{\texorpdfstring{\+\_\+\+T\+X\+\_\+\+E\+X\+I\+T()}{_TX_EXIT()}}]{\setlength{\rightskip}{0pt plus 5cm}void T\+M\+::\+\_\+\+T\+X\+\_\+\+E\+X\+IT (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\hypertarget{class_t_m_a5e2d1127f2429f2f524d25f430eade06_a5e2d1127f2429f2f524d25f430eade06}{}\label{class_t_m_a5e2d1127f2429f2f524d25f430eade06_a5e2d1127f2429f2f524d25f430eade06}


\+\_\+\+T\+X\+\_\+\+E\+X\+IT void, the thread calls the ostm\+\_\+exit function in the transaction, and clear all elements from the shared global collection associated with the main process 

\+\_\+\+T\+X\+\_\+\+E\+X\+IT void, the thread calls the ostm\+\_\+exit function in the transaction, and clear all elements from the shared global collection associated with the main process  tx \hyperlink{class_t_x}{TX}, local object to function in transaction 

Definition at line \hyperlink{_t_m_8cpp_source_l00102}{102} of file \hyperlink{_t_m_8cpp_source}{T\+M.\+cpp}.



References \hyperlink{_t_x_8cpp_source_l00072}{T\+X\+::ostm\+\_\+exit()}, \hyperlink{_t_m_8h_source_l00047}{process\+\_\+map\+\_\+collection}, and \hyperlink{_t_m_8h_source_l00042}{tx\+Map}.



Referenced by \hyperlink{_my_test_c_ase_8cpp_source_l00412}{My\+Test\+C\+Ase\+::complex\+\_\+threaded\+\_\+functionality\+\_\+hundred\+\_\+threads()}, \hyperlink{_my_test_c_ase_8cpp_source_l00467}{My\+Test\+C\+Ase\+::complex\+\_\+threaded\+\_\+functionality\+\_\+ten\+\_\+threads()}, \hyperlink{_my_test_c_ase_8cpp_source_l00922}{My\+Test\+C\+Ase\+::multi\+\_\+threaded\+\_\+multiple\+\_\+object\+\_\+exchange\+\_\+test()}, \hyperlink{_my_test_c_ase_8cpp_source_l01040}{My\+Test\+C\+Ase\+::multi\+\_\+threaded\+\_\+multiple\+\_\+objects\+\_\+test()}, \hyperlink{_my_test_c_ase_8cpp_source_l00954}{My\+Test\+C\+Ase\+::multi\+\_\+threaded\+\_\+single\+\_\+object\+\_\+test\+\_\+with\+\_\+ten\+\_\+threads()}, \hyperlink{_my_test_c_ase_8cpp_source_l00680}{My\+Test\+C\+Ase\+::nested\+\_\+hundred\+\_\+thread\+\_\+functionality()}, \hyperlink{_my_test_c_ase_8cpp_source_l00715}{My\+Test\+C\+Ase\+::nested\+\_\+thousand\+\_\+thread\+\_\+functionality()}, \hyperlink{_my_test_c_ase_8cpp_source_l00787}{My\+Test\+C\+Ase\+::nested\+\_\+transaction\+\_\+object\+\_\+test()}, \hyperlink{_my_test_c_ase_8cpp_source_l00983}{My\+Test\+C\+Ase\+::single\+\_\+threaded\+\_\+multiple\+\_\+object\+\_\+test()}, \hyperlink{_my_test_c_ase_8cpp_source_l00523}{My\+Test\+C\+Ase\+::threaded\+\_\+functionality\+\_\+hundred\+\_\+threads()}, \hyperlink{_my_test_c_ase_8cpp_source_l00589}{My\+Test\+C\+Ase\+::threaded\+\_\+functionality\+\_\+hundred\+\_\+threads\+\_\+six\+\_\+account()}, \hyperlink{_my_test_c_ase_8cpp_source_l00556}{My\+Test\+C\+Ase\+::threaded\+\_\+functionality\+\_\+thousand\+\_\+threads()}, \hyperlink{_my_test_c_ase_8cpp_source_l00634}{My\+Test\+C\+Ase\+::threaded\+\_\+functionality\+\_\+thousand\+\_\+threads\+\_\+six\+\_\+account()}, \hyperlink{_my_test_c_ase_8cpp_source_l00748}{My\+Test\+C\+Ase\+::two\+\_\+object\+\_\+transfer\+\_\+complete()}, and \hyperlink{_my_test_c_ase_8cpp_source_l00765}{My\+Test\+C\+Ase\+::two\+\_\+object\+\_\+transfer\+\_\+state\+\_\+change()}.


\begin{DoxyCode}
00102                  \{
00103     \hyperlink{class_t_x}{TX} tx(std::this\_thread::get\_id());
00104     \textcolor{keywordtype}{int} ppid = getpid();
00105     std::map<int, std::map< std::thread::id, int >>::iterator process\_map\_collection\_Iterator = 
      \hyperlink{class_t_m_a81c3bd28ad2343a620fa070f8ac186ca_a81c3bd28ad2343a620fa070f8ac186ca}{TM::process\_map\_collection}.find(ppid);
00106     \textcolor{keywordflow}{if} (process\_map\_collection\_Iterator != \hyperlink{class_t_m_a81c3bd28ad2343a620fa070f8ac186ca_a81c3bd28ad2343a620fa070f8ac186ca}{TM::process\_map\_collection}.end()) \{
00107 
00108         \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} current = process\_map\_collection\_Iterator->second.begin(); current != 
      process\_map\_collection\_Iterator->second.end(); ++current) \{
00109             \textcolor{comment}{/*}
00110 \textcolor{comment}{             * Delete all transaction associated with the actual main process}
00111 \textcolor{comment}{             */}
00112             \hyperlink{class_t_m_a0333dfa193ea99d7626de74a2b932e9b_a0333dfa193ea99d7626de74a2b932e9b}{txMap}.erase(current->first);
00113         \}
00114         \hyperlink{class_t_m_a81c3bd28ad2343a620fa070f8ac186ca_a81c3bd28ad2343a620fa070f8ac186ca}{TM::process\_map\_collection}.erase(ppid);
00115 
00116     \}
00117     tx.ostm\_exit();
00118 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=277pt]{class_t_m_a5e2d1127f2429f2f524d25f430eade06_a5e2d1127f2429f2f524d25f430eade06_cgraph}
\end{center}
\end{figure}


\index{TM@{TM}!get\+\_\+thread\+\_\+\+Map@{get\+\_\+thread\+\_\+\+Map}}
\index{get\+\_\+thread\+\_\+\+Map@{get\+\_\+thread\+\_\+\+Map}!TM@{TM}}
\paragraph[{\texorpdfstring{get\+\_\+thread\+\_\+\+Map()}{get_thread_Map()}}]{\setlength{\rightskip}{0pt plus 5cm}std\+::map$<$ std\+::thread\+::id, int $>$ T\+M\+::get\+\_\+thread\+\_\+\+Map (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\hypertarget{class_t_m_afb8bc9f42fe06c52747beb7f4c46915c_afb8bc9f42fe06c52747beb7f4c46915c}{}\label{class_t_m_afb8bc9f42fe06c52747beb7f4c46915c_afb8bc9f42fe06c52747beb7f4c46915c}


get\+\_\+thread\+\_\+\+Map std\+::map, returning a map to store all unique ID from all objects from all transactions within the main process 


\begin{DoxyParams}{Parameters}
{\em thread\+\_\+\+Map} & std\+::map$<$ int, int $>$, \\
\hline
\end{DoxyParams}


Definition at line \hyperlink{_t_m_8cpp_source_l00134}{134} of file \hyperlink{_t_m_8cpp_source}{T\+M.\+cpp}.



Referenced by \hyperlink{_t_m_8h_source_l00091}{operator==()}, \hyperlink{_t_m_8cpp_source_l00043}{register\+T\+X()}, and \hyperlink{_my_test_c_ase_8cpp_source_l00903}{My\+Test\+C\+Ase\+::\+T\+M\+\_\+get\+\_\+thread\+\_\+map()}.


\begin{DoxyCode}
00134                                               \{
00135     std::map< std::thread::id, int > thread\_Map;
00136     \textcolor{keywordflow}{return} thread\_Map;
00137 \}
\end{DoxyCode}
\index{TM@{TM}!Instance@{Instance}}
\index{Instance@{Instance}!TM@{TM}}
\paragraph[{\texorpdfstring{Instance()}{Instance()}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf TM} \& T\+M\+::\+Instance (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{class_t_m_a7ce5f35e0dae76df4fe116cf905bbe60_a7ce5f35e0dae76df4fe116cf905bbe60}{}\label{class_t_m_a7ce5f35e0dae76df4fe116cf905bbe60_a7ce5f35e0dae76df4fe116cf905bbe60}


Scott Meyer\textquotesingle{}s Singleton creation, what is thread safe. 

Instance \hyperlink{class_t_m}{TM}, return the same singleton object to any process.


\begin{DoxyParams}{Parameters}
{\em \+\_\+instance} & \hyperlink{class_t_m}{TM}, static class reference to the instance of the Transaction Manager class \\
\hline
{\em \+\_\+instance} & ppid, assigning the process id whoever created the Singleton instance \\
\hline
\end{DoxyParams}


Definition at line \hyperlink{_t_m_8cpp_source_l00028}{28} of file \hyperlink{_t_m_8cpp_source}{T\+M.\+cpp}.



References \hyperlink{_t_m_8h_source_l00067}{\+\_\+tm\+\_\+id}.



Referenced by \hyperlink{_my_test_c_ase_8cpp_source_l00896}{My\+Test\+C\+Ase\+::compare\+\_\+\+Transaction\+\_\+\+Manager\+\_\+singleton\+\_\+instance()}.


\begin{DoxyCode}
00028                  \{
00029     \textcolor{keyword}{static} \hyperlink{class_t_m}{TM} \_instance;
00030     \_instance.\hyperlink{class_t_m_a6fb90615393f9205838e302c714bbd60_a6fb90615393f9205838e302c714bbd60}{\_tm\_id} = getpid();
00031 
00032     \textcolor{keywordflow}{return} \_instance;
00033 \}
\end{DoxyCode}
\index{TM@{TM}!operator=@{operator=}}
\index{operator=@{operator=}!TM@{TM}}
\paragraph[{\texorpdfstring{operator=(const T\+M \&)=delete}{operator=(const TM &)=delete}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf TM}\& T\+M\+::operator= (
\begin{DoxyParamCaption}
\item[{const {\bf TM} \&}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}, {\ttfamily [delete]}}\hypertarget{class_t_m_a85a6b783f0566f0877bab6a7de977c0a_a85a6b783f0566f0877bab6a7de977c0a}{}\label{class_t_m_a85a6b783f0566f0877bab6a7de977c0a_a85a6b783f0566f0877bab6a7de977c0a}


\hyperlink{class_t_m}{TM} copy operator, prevent from copying the Transaction Manager. 

\index{TM@{TM}!operator==@{operator==}}
\index{operator==@{operator==}!TM@{TM}}
\paragraph[{\texorpdfstring{operator==(const T\+M \&rhs) const }{operator==(const TM &rhs) const }}]{\setlength{\rightskip}{0pt plus 5cm}bool T\+M\+::operator== (
\begin{DoxyParamCaption}
\item[{const {\bf TM} \&}]{rhs}
\end{DoxyParamCaption}
) const\hspace{0.3cm}{\ttfamily [inline]}}\hypertarget{class_t_m_a3285005a8f3e9fed99b024dac86fae05_a3285005a8f3e9fed99b024dac86fae05}{}\label{class_t_m_a3285005a8f3e9fed99b024dac86fae05_a3285005a8f3e9fed99b024dac86fae05}


Definition at line \hyperlink{_t_m_8h_source_l00091}{91} of file \hyperlink{_t_m_8h_source}{T\+M.\+h}.



References \hyperlink{_t_m_8cpp_source_l00134}{get\+\_\+thread\+\_\+\+Map()}.


\begin{DoxyCode}
00091                                          \{
00092         \textcolor{keywordflow}{return} &rhs == \textcolor{keyword}{this};
00093     \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=307pt]{class_t_m_a3285005a8f3e9fed99b024dac86fae05_a3285005a8f3e9fed99b024dac86fae05_cgraph}
\end{center}
\end{figure}


\index{TM@{TM}!print\+\_\+all@{print\+\_\+all}}
\index{print\+\_\+all@{print\+\_\+all}!TM@{TM}}
\paragraph[{\texorpdfstring{print\+\_\+all()}{print_all()}}]{\setlength{\rightskip}{0pt plus 5cm}void T\+M\+::print\+\_\+all (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\hypertarget{class_t_m_a1d6891b1d3e71cc0acef54e7afe71c09_a1d6891b1d3e71cc0acef54e7afe71c09}{}\label{class_t_m_a1d6891b1d3e71cc0acef54e7afe71c09_a1d6891b1d3e71cc0acef54e7afe71c09}


O\+N\+LY F\+OR T\+E\+S\+T\+I\+NG print\+\_\+all void, print out all object key from tx\+M\+AP collection. 

O\+N\+LY F\+OR T\+E\+S\+T\+I\+NG print\+\_\+all void, prints all object in the tx\+Map 

Definition at line \hyperlink{_t_m_8cpp_source_l00122}{122} of file \hyperlink{_t_m_8cpp_source}{T\+M.\+cpp}.



References \hyperlink{_t_m_8h_source_l00063}{get\+\_\+\+Lock}, and \hyperlink{_t_m_8h_source_l00042}{tx\+Map}.


\begin{DoxyCode}
00122                   \{
00123     \hyperlink{class_t_m_a123bc5aa0766a7b909bebc54a429e5b0_a123bc5aa0766a7b909bebc54a429e5b0}{get\_Lock}.lock();
00124     \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} current = \hyperlink{class_t_m_a0333dfa193ea99d7626de74a2b932e9b_a0333dfa193ea99d7626de74a2b932e9b}{txMap}.begin(); current != \hyperlink{class_t_m_a0333dfa193ea99d7626de74a2b932e9b_a0333dfa193ea99d7626de74a2b932e9b}{txMap}.end(); ++current) \{
00125         std::cout << \textcolor{stringliteral}{"KEY : "} << current->first << std::endl;
00126     \}
00127     \hyperlink{class_t_m_a123bc5aa0766a7b909bebc54a429e5b0_a123bc5aa0766a7b909bebc54a429e5b0}{get\_Lock}.unlock();
00128 \}
\end{DoxyCode}
\index{TM@{TM}!register\+TX@{register\+TX}}
\index{register\+TX@{register\+TX}!TM@{TM}}
\paragraph[{\texorpdfstring{register\+T\+X()}{registerTX()}}]{\setlength{\rightskip}{0pt plus 5cm}void T\+M\+::register\+TX (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [private]}}\hypertarget{class_t_m_a26ea481c24d9aa3aebd6dafb7253376e_a26ea481c24d9aa3aebd6dafb7253376e}{}\label{class_t_m_a26ea481c24d9aa3aebd6dafb7253376e_a26ea481c24d9aa3aebd6dafb7253376e}


get\+\_\+thread\+\_\+\+Map returning and map to insert to the process\+\_\+map\+\_\+collection as an inner value 

register\+TX void, register a new \hyperlink{class_t_x}{TX} Transaction object into ythe tx\+Map/\+Transaction Map to manage all the transactions within the shared library

register\+TX void, register transaction into tx\+Map


\begin{DoxyParams}{Parameters}
{\em tx\+Map} & std\+::map, collection to store all transaction created by the Transaction Manager \\
\hline
{\em register\+\_\+\+Lock} & std\+::mutex, used by the lock\+\_\+guard to protect shared map from race conditions \\
\hline
{\em guard} & std\+::lock\+\_\+guard, locks the register\+\_\+\+Lock mutex, unlock automatically when goes out of the scope \\
\hline
\end{DoxyParams}


Definition at line \hyperlink{_t_m_8cpp_source_l00043}{43} of file \hyperlink{_t_m_8cpp_source}{T\+M.\+cpp}.



References \hyperlink{_t_m_8cpp_source_l00134}{get\+\_\+thread\+\_\+\+Map()}, \hyperlink{_t_m_8h_source_l00047}{process\+\_\+map\+\_\+collection}, \hyperlink{_t_m_8h_source_l00059}{register\+\_\+\+Lock}, and \hyperlink{_t_m_8h_source_l00042}{tx\+Map}.



Referenced by \hyperlink{_t_m_8cpp_source_l00079}{\+\_\+get\+\_\+tx()}.


\begin{DoxyCode}
00044 \{
00045     std::lock\_guard<std::mutex> guard(\hyperlink{class_t_m_aeb26546681bfe64e21606b8c012bb8c3_aeb26546681bfe64e21606b8c012bb8c3}{register\_Lock});
00046     \textcolor{keywordtype}{int} ppid = getpid();
00047     std::map<int, std::map< std::thread::id, int >>::iterator process\_map\_collection\_Iterator = 
      \hyperlink{class_t_m_a81c3bd28ad2343a620fa070f8ac186ca_a81c3bd28ad2343a620fa070f8ac186ca}{TM::process\_map\_collection}.find(ppid);
00048     \textcolor{keywordflow}{if} (process\_map\_collection\_Iterator == \hyperlink{class_t_m_a81c3bd28ad2343a620fa070f8ac186ca_a81c3bd28ad2343a620fa070f8ac186ca}{TM::process\_map\_collection}.end()) \{
00049         \textcolor{comment}{/*}
00050 \textcolor{comment}{         * Register main process/application to the global map}
00051 \textcolor{comment}{         */}
00052         std::map< std::thread::id, int >map = \hyperlink{class_t_m_afb8bc9f42fe06c52747beb7f4c46915c_afb8bc9f42fe06c52747beb7f4c46915c}{get\_thread\_Map}();
00053         \hyperlink{class_t_m_a81c3bd28ad2343a620fa070f8ac186ca_a81c3bd28ad2343a620fa070f8ac186ca}{TM::process\_map\_collection}.insert(\{ppid, map\});
00054 
00055     \}
00056     std::map<std::thread::id, std::shared\_ptr < TX>>::iterator it = \hyperlink{class_t_m_a0333dfa193ea99d7626de74a2b932e9b_a0333dfa193ea99d7626de74a2b932e9b}{txMap}.find(
      std::this\_thread::get\_id());
00057     \textcolor{keywordflow}{if} (it == \hyperlink{class_t_m_a0333dfa193ea99d7626de74a2b932e9b_a0333dfa193ea99d7626de74a2b932e9b}{txMap}.end()) \{
00058         std::shared\_ptr<TX> \_transaction\_object(\textcolor{keyword}{new} \hyperlink{class_t_x}{TX}(std::this\_thread::get\_id()));
00059         \hyperlink{class_t_m_a0333dfa193ea99d7626de74a2b932e9b_a0333dfa193ea99d7626de74a2b932e9b}{txMap}.insert(\{std::this\_thread::get\_id(), \_transaction\_object\});
00060         \textcolor{comment}{/*}
00061 \textcolor{comment}{         * Get the map if registered first time}
00062 \textcolor{comment}{         */}
00063         process\_map\_collection\_Iterator = \hyperlink{class_t_m_a81c3bd28ad2343a620fa070f8ac186ca_a81c3bd28ad2343a620fa070f8ac186ca}{TM::process\_map\_collection}.find(ppid);
00064         \textcolor{comment}{/*}
00065 \textcolor{comment}{         * Insert to the GLOBAL MAP as a helper to clean up at end of main process }
00066 \textcolor{comment}{         */}
00067         process\_map\_collection\_Iterator->second.insert(\{std::this\_thread::get\_id(), 1\});
00068 
00069     \}
00070 
00071 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=305pt]{class_t_m_a26ea481c24d9aa3aebd6dafb7253376e_a26ea481c24d9aa3aebd6dafb7253376e_cgraph}
\end{center}
\end{figure}




\subsubsection{Member Data Documentation}
\index{TM@{TM}!\+\_\+tm\+\_\+id@{\+\_\+tm\+\_\+id}}
\index{\+\_\+tm\+\_\+id@{\+\_\+tm\+\_\+id}!TM@{TM}}
\paragraph[{\texorpdfstring{\+\_\+tm\+\_\+id}{_tm_id}}]{\setlength{\rightskip}{0pt plus 5cm}int T\+M\+::\+\_\+tm\+\_\+id\hspace{0.3cm}{\ttfamily [static]}, {\ttfamily [private]}}\hypertarget{class_t_m_a6fb90615393f9205838e302c714bbd60_a6fb90615393f9205838e302c714bbd60}{}\label{class_t_m_a6fb90615393f9205838e302c714bbd60_a6fb90615393f9205838e302c714bbd60}

\begin{DoxyParams}{Parameters}
{\em \+\_\+tm\+\_\+id} & pid\+\_\+t, process id determine the actual process between process in the shared \hyperlink{class_o_s_t_m}{O\+S\+TM} library \\
\hline
\end{DoxyParams}


Definition at line \hyperlink{_t_m_8h_source_l00067}{67} of file \hyperlink{_t_m_8h_source}{T\+M.\+h}.



Referenced by \hyperlink{_t_m_8cpp_source_l00028}{Instance()}.

\index{TM@{TM}!get\+\_\+\+Lock@{get\+\_\+\+Lock}}
\index{get\+\_\+\+Lock@{get\+\_\+\+Lock}!TM@{TM}}
\paragraph[{\texorpdfstring{get\+\_\+\+Lock}{get_Lock}}]{\setlength{\rightskip}{0pt plus 5cm}std\+::mutex T\+M\+::get\+\_\+\+Lock\hspace{0.3cm}{\ttfamily [private]}}\hypertarget{class_t_m_a123bc5aa0766a7b909bebc54a429e5b0_a123bc5aa0766a7b909bebc54a429e5b0}{}\label{class_t_m_a123bc5aa0766a7b909bebc54a429e5b0_a123bc5aa0766a7b909bebc54a429e5b0}

\begin{DoxyParams}{Parameters}
{\em register\+\_\+\+Lock} & std\+::mutex, used in the \+\_\+get\+\_\+tx function \\
\hline
\end{DoxyParams}


Definition at line \hyperlink{_t_m_8h_source_l00063}{63} of file \hyperlink{_t_m_8h_source}{T\+M.\+h}.



Referenced by \hyperlink{_t_m_8cpp_source_l00079}{\+\_\+get\+\_\+tx()}, and \hyperlink{_t_m_8cpp_source_l00122}{print\+\_\+all()}.

\index{TM@{TM}!process\+\_\+map\+\_\+collection@{process\+\_\+map\+\_\+collection}}
\index{process\+\_\+map\+\_\+collection@{process\+\_\+map\+\_\+collection}!TM@{TM}}
\paragraph[{\texorpdfstring{process\+\_\+map\+\_\+collection}{process_map_collection}}]{\setlength{\rightskip}{0pt plus 5cm}std\+::map$<$ int, std\+::map$<$ std\+::thread\+::id, int $>$ $>$ T\+M\+::process\+\_\+map\+\_\+collection\hspace{0.3cm}{\ttfamily [static]}, {\ttfamily [private]}}\hypertarget{class_t_m_a81c3bd28ad2343a620fa070f8ac186ca_a81c3bd28ad2343a620fa070f8ac186ca}{}\label{class_t_m_a81c3bd28ad2343a620fa070f8ac186ca_a81c3bd28ad2343a620fa070f8ac186ca}


S\+T\+A\+T\+IC G\+L\+O\+B\+AL M\+AP Collection to store all process associated keys to find when deleting transactions. 


\begin{DoxyParams}{Parameters}
{\em process\+\_\+map\+\_\+collection} & std\+::map\\
\hline
{\em static} & Global std\+::map process\+\_\+map\+\_\+collection store all transactional objects/pointers \\
\hline
\end{DoxyParams}


Definition at line \hyperlink{_t_m_8h_source_l00047}{47} of file \hyperlink{_t_m_8h_source}{T\+M.\+h}.



Referenced by \hyperlink{_t_m_8cpp_source_l00102}{\+\_\+\+T\+X\+\_\+\+E\+X\+I\+T()}, and \hyperlink{_t_m_8cpp_source_l00043}{register\+T\+X()}.

\index{TM@{TM}!register\+\_\+\+Lock@{register\+\_\+\+Lock}}
\index{register\+\_\+\+Lock@{register\+\_\+\+Lock}!TM@{TM}}
\paragraph[{\texorpdfstring{register\+\_\+\+Lock}{register_Lock}}]{\setlength{\rightskip}{0pt plus 5cm}std\+::mutex T\+M\+::register\+\_\+\+Lock\hspace{0.3cm}{\ttfamily [private]}}\hypertarget{class_t_m_aeb26546681bfe64e21606b8c012bb8c3_aeb26546681bfe64e21606b8c012bb8c3}{}\label{class_t_m_aeb26546681bfe64e21606b8c012bb8c3_aeb26546681bfe64e21606b8c012bb8c3}

\begin{DoxyParams}{Parameters}
{\em register\+\_\+\+Lock} & std\+::mutex, used in the register\+TX function \\
\hline
\end{DoxyParams}


Definition at line \hyperlink{_t_m_8h_source_l00059}{59} of file \hyperlink{_t_m_8h_source}{T\+M.\+h}.



Referenced by \hyperlink{_t_m_8cpp_source_l00043}{register\+T\+X()}.

\index{TM@{TM}!tx\+Map@{tx\+Map}}
\index{tx\+Map@{tx\+Map}!TM@{TM}}
\paragraph[{\texorpdfstring{tx\+Map}{txMap}}]{\setlength{\rightskip}{0pt plus 5cm}std\+::map$<$std\+::thread\+::id, std\+::shared\+\_\+ptr$<${\bf TX}$>$ $>$ T\+M\+::tx\+Map\hspace{0.3cm}{\ttfamily [private]}}\hypertarget{class_t_m_a0333dfa193ea99d7626de74a2b932e9b_a0333dfa193ea99d7626de74a2b932e9b}{}\label{class_t_m_a0333dfa193ea99d7626de74a2b932e9b_a0333dfa193ea99d7626de74a2b932e9b}

\begin{DoxyParams}{Parameters}
{\em tx\+Map} & std\+::map, store all transactional objects created with Transaction Manager \\
\hline
\end{DoxyParams}


Definition at line \hyperlink{_t_m_8h_source_l00042}{42} of file \hyperlink{_t_m_8h_source}{T\+M.\+h}.



Referenced by \hyperlink{_t_m_8cpp_source_l00079}{\+\_\+get\+\_\+tx()}, \hyperlink{_t_m_8cpp_source_l00102}{\+\_\+\+T\+X\+\_\+\+E\+X\+I\+T()}, \hyperlink{_t_m_8cpp_source_l00122}{print\+\_\+all()}, and \hyperlink{_t_m_8cpp_source_l00043}{register\+T\+X()}.



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
\hyperlink{_t_m_8h}{T\+M.\+h}\item 
\hyperlink{_t_m_8cpp}{T\+M.\+cpp}\end{DoxyCompactItemize}
