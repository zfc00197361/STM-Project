<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>C++ Software transactional Memory: _nesting_</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">C++ Software transactional Memory
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('main_8cpp_a5675cb594d74aa1bf5e80233370ffd81.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="contents">
<a class="anchor" id="a5675cb594d74aa1bf5e80233370ffd81"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void _nesting_ </td>
          <td>(</td>
          <td class="paramtype">std::shared_ptr&lt; <a class="el" href="class_o_s_t_m.html">OSTM</a> &gt;&#160;</td>
          <td class="paramname"><em>_to_</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::shared_ptr&lt; <a class="el" href="class_o_s_t_m.html">OSTM</a> &gt;&#160;</td>
          <td class="paramname"><em>_from_</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_t_m.html">TM</a> &amp;&#160;</td>
          <td class="paramname"><em>_tm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>_amount</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><em>nesting</em> function, takes two std::shared_ptr&lt;OSTM&gt; pointer, the Transaction manager, and the amount to use in the transaction and transfer the _amount value from one account to the another account This function create nested transactions inside the transaction, and call other function to nesting the transaction as well </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">_tm</td><td><a class="el" href="class_t_m.html">TM</a>, transaction Manager </td></tr>
    <tr><td class="paramname">_to</td><td>std::shared_ptr&lt;BANK&gt; </td></tr>
    <tr><td class="paramname">_from</td><td>std::shared_ptr&lt;OSTM&gt; </td></tr>
    <tr><td class="paramname">_amount</td><td>double value </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="main_8cpp_source.html#l00077">77</a> of file <a class="el" href="main_8cpp_source.html">main.cpp</a>.</p>

<p>References <a class="el" href="_t_m_8cpp_source.html#l00081">TM::_get_tx()</a>, <a class="el" href="main_8cpp_source.html#l00032">_two_account_transfer_()</a>, and <a class="el" href="_b_a_n_k_8h_source.html#l00049">BANK::SetBalance()</a>.</p>

<p>Referenced by <a class="el" href="main_8cpp_source.html#l00142">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;                                                                                              {</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="comment">/* @79 Request fro transaction object with the transaction manager*/</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    std::shared_ptr&lt;TX&gt; tx = _tm.<a class="code" href="class_t_m_a41cb0226cc4080c931651b13f74a0075.html#a41cb0226cc4080c931651b13f74a0075">_get_tx</a>();</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="comment">/* @81-82 Register the two OSTM type shared pointer to the library : _to_ and _from_ */</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    tx-&gt;_register(_to_);</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    tx-&gt;_register(_from_);</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="comment">/*  @84-85 We need to create local pointers to use the temporary pointers in the transaction */</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    std::shared_ptr&lt;BANK&gt; _TO_BANK_, _FROM_BANK_;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    std::shared_ptr&lt;OSTM&gt; _TO_OSTM_, _FROM_OSTM_;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="comment">/* @87 Declare boolean variable to control the transaction with the while loop*/</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="keywordtype">bool</span> done = <span class="keyword">false</span>;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;     <span class="comment">/* @89 Use try catch blocks ! If you try to use exidantly any nullpointer to register,save or load in the libaray, then the library wil throw a runtime execption*/</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="keywordflow">try</span> {</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        <span class="comment">/* @91 Declare the WHILE loop with the boolean variable */</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        <span class="keywordflow">while</span> (!done) {</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;            <span class="comment">/* @93-94 Retrieve the copy OSTM type pointers you registered (_to_ and _from_) from the library, and cast it back to BANK type. In this way you can used the BANK virtual methods to access the AIB and BOI objects values*/</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;            _TO_BANK_ = std::dynamic_pointer_cast&lt;<a class="code" href="class_b_a_n_k.html">BANK</a>&gt; (tx-&gt;load(_to_));</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;            _FROM_BANK_ = std::dynamic_pointer_cast&lt;<a class="code" href="class_b_a_n_k.html">BANK</a>&gt; (tx-&gt;load(_from_));</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;            </div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;            <span class="comment">/* @97-98 make changes with the local pointers */</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;            _TO_BANK_-&gt;<a class="code" href="class_b_a_n_k_ae3e45b407bf8ec7175662442ea24b7c0.html#ae3e45b407bf8ec7175662442ea24b7c0">SetBalance</a>(_TO_BANK_-&gt;GetBalance() + _amount);</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;            _FROM_BANK_-&gt;SetBalance(_FROM_BANK_-&gt;GetBalance() - _amount);</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;            <span class="comment">/* @100-101 Cast back the BANK type pointers to OSTM type before try to store the changes with the objetcs */</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;            _TO_OSTM_ = std::dynamic_pointer_cast&lt;<a class="code" href="class_o_s_t_m.html">OSTM</a>&gt; (_TO_BANK_);</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;            _FROM_OSTM_ = std::dynamic_pointer_cast&lt;<a class="code" href="class_o_s_t_m.html">OSTM</a>&gt; (_FROM_BANK_);</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;            <span class="comment">/* @103-104 Store changes has made with the local pointers */</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;            tx-&gt;store(_TO_OSTM_);</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;            tx-&gt;store(_FROM_OSTM_);</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;            </div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;            <span class="comment">/* @107 Retrieve a Transaction object to used in the NESTED TRANSACTION. Because the same thread request the transaction object the transaction manager will return back the same transaction object, and increase the nesting associated with the transaction */</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;            std::shared_ptr&lt;TX&gt; txTwo = _tm.<a class="code" href="class_t_m_a41cb0226cc4080c931651b13f74a0075.html#a41cb0226cc4080c931651b13f74a0075">_get_tx</a>();</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;             <span class="comment">/* @109 Declare boolean variable to control the nested transaction with the while loop*/</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;            <span class="keywordtype">bool</span> nestedDone = <span class="keyword">false</span>;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;            <span class="comment">/* @111 Declare the WHILE loop with the boolean variable */</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;            <span class="keywordflow">while</span> (!nestedDone) {</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;            </div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                <span class="comment">/* @114-115Retrieve the copy OSTM type pointers you registered (_to_ and _from_) from the library, and cast it back to BANK type. In this way you can used the BANK virtual methods to access the AIB and BOI objects values*/</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                _TO_BANK_ = std::dynamic_pointer_cast&lt;<a class="code" href="class_b_a_n_k.html">BANK</a>&gt; (txTwo-&gt;load(_to_));</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                _FROM_BANK_ = std::dynamic_pointer_cast&lt;<a class="code" href="class_b_a_n_k.html">BANK</a>&gt; (txTwo-&gt;load(_from_));</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                <span class="comment">/* @117-118 make changes with the local pointers */</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                _TO_BANK_-&gt;<a class="code" href="class_b_a_n_k_ae3e45b407bf8ec7175662442ea24b7c0.html#ae3e45b407bf8ec7175662442ea24b7c0">SetBalance</a>(_TO_BANK_-&gt;GetBalance() + _amount);</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                _FROM_BANK_-&gt;SetBalance(_FROM_BANK_-&gt;GetBalance() - _amount);</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                <span class="comment">/* @120-121 Cast back the BANK type pointers to OSTM type before try to store the changes with the objetcs */</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                _TO_OSTM_ = std::dynamic_pointer_cast&lt;<a class="code" href="class_o_s_t_m.html">OSTM</a>&gt; (_TO_BANK_);</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                _FROM_OSTM_ = std::dynamic_pointer_cast&lt;<a class="code" href="class_o_s_t_m.html">OSTM</a>&gt; (_FROM_BANK_);</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                <span class="comment">/* @123-124 Store changes has made with the local pointers */</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                txTwo-&gt;store(_TO_OSTM_);</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                txTwo-&gt;store(_FROM_OSTM_);</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                <span class="comment">/* @126 Call other function that will nesting the transaction to the next level */</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                <a class="code" href="main_8cpp_a83aef8c5b69afef4e38d14c17fe782b3.html#a83aef8c5b69afef4e38d14c17fe782b3">_two_account_transfer_</a>(_to_, _from_, _tm, _amount);</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                <span class="comment">/* @128 Commit changes with the nested transaction*/</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                nestedDone = txTwo-&gt;commit();</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;            }</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;            <span class="comment">/* @131 Commit changes with the outer transaction*/</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;            done = tx-&gt;commit();</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        }</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="comment">/* @134-135 Catch block to catch runtime errors. Print error to console*/</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    } <span class="keywordflow">catch</span> (std::runtime_error&amp; e) {</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        std::cout &lt;&lt; e.what() &lt;&lt; std::endl;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    }</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;}</div><div class="ttc" id="class_b_a_n_k_html"><div class="ttname"><a href="class_b_a_n_k.html">BANK</a></div><div class="ttdef"><b>Definition:</b> <a href="_b_a_n_k_8h_source.html#l00021">BANK.h:21</a></div></div>
<div class="ttc" id="main_8cpp_a83aef8c5b69afef4e38d14c17fe782b3_html_a83aef8c5b69afef4e38d14c17fe782b3"><div class="ttname"><a href="main_8cpp_a83aef8c5b69afef4e38d14c17fe782b3.html#a83aef8c5b69afef4e38d14c17fe782b3">_two_account_transfer_</a></div><div class="ttdeci">void _two_account_transfer_(std::shared_ptr&lt; OSTM &gt; _to_, std::shared_ptr&lt; OSTM &gt; _from_, TM &amp;_tm, double _amount)</div><div class="ttdoc">two_account_transfer function, takes two OSTM type shared pointer, the Transaction manager...</div><div class="ttdef"><b>Definition:</b> <a href="main_8cpp_source.html#l00032">main.cpp:32</a></div></div>
<div class="ttc" id="class_t_m_a41cb0226cc4080c931651b13f74a0075_html_a41cb0226cc4080c931651b13f74a0075"><div class="ttname"><a href="class_t_m_a41cb0226cc4080c931651b13f74a0075.html#a41cb0226cc4080c931651b13f74a0075">TM::_get_tx</a></div><div class="ttdeci">std::shared_ptr&lt; TX &gt; const _get_tx()</div><div class="ttdoc">@81 _get_tx std::shared_ptr&lt;TX&gt;, return an trtansaction Object as a shared_ptr, if TX not exists then...</div><div class="ttdef"><b>Definition:</b> <a href="_t_m_8cpp_source.html#l00081">TM.cpp:81</a></div></div>
<div class="ttc" id="class_o_s_t_m_html"><div class="ttname"><a href="class_o_s_t_m.html">OSTM</a></div><div class="ttdef"><b>Definition:</b> <a href="_o_s_t_m_8h_source.html#l00023">OSTM.h:23</a></div></div>
<div class="ttc" id="class_b_a_n_k_ae3e45b407bf8ec7175662442ea24b7c0_html_ae3e45b407bf8ec7175662442ea24b7c0"><div class="ttname"><a href="class_b_a_n_k_ae3e45b407bf8ec7175662442ea24b7c0.html#ae3e45b407bf8ec7175662442ea24b7c0">BANK::SetBalance</a></div><div class="ttdeci">virtual void SetBalance(double balance)</div><div class="ttdef"><b>Definition:</b> <a href="_b_a_n_k_8h_source.html#l00049">BANK.h:49</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="main_8cpp_a5675cb594d74aa1bf5e80233370ffd81_a5675cb594d74aa1bf5e80233370ffd81_cgraph.png" border="0" usemap="#main_8cpp_a5675cb594d74aa1bf5e80233370ffd81_a5675cb594d74aa1bf5e80233370ffd81_cgraph" alt=""/></div>
<map name="main_8cpp_a5675cb594d74aa1bf5e80233370ffd81_a5675cb594d74aa1bf5e80233370ffd81_cgraph" id="main_8cpp_a5675cb594d74aa1bf5e80233370ffd81_a5675cb594d74aa1bf5e80233370ffd81_cgraph">
<area shape="rect" id="node2" href="class_t_m_a41cb0226cc4080c931651b13f74a0075.html#a41cb0226cc4080c931651b13f74a0075" title="@81 _get_tx std::shared_ptr&lt;TX&gt;, return an trtansaction Object as a shared_ptr, if TX not exists then..." alt="" coords="363,5,455,32"/>
<area shape="rect" id="node5" href="main_8cpp_a83aef8c5b69afef4e38d14c17fe782b3.html#a83aef8c5b69afef4e38d14c17fe782b3" title="two_account_transfer function, takes two OSTM type shared pointer, the Transaction manager..." alt="" coords="132,31,293,57"/>
<area shape="rect" id="node6" href="class_b_a_n_k_ae3e45b407bf8ec7175662442ea24b7c0.html#ae3e45b407bf8ec7175662442ea24b7c0" title="BANK::SetBalance" alt="" coords="341,68,476,95"/>
<area shape="rect" id="node3" href="class_t_m_a26ea481c24d9aa3aebd6dafb7253376e.html#a26ea481c24d9aa3aebd6dafb7253376e" title="@45 registerTX void function, register a new TX Transaction object into ythe txMap/Transaction Map to..." alt="" coords="524,5,633,32"/>
<area shape="rect" id="node4" href="class_t_m_afb8bc9f42fe06c52747beb7f4c46915c.html#afb8bc9f42fe06c52747beb7f4c46915c" title="@148 get_thread_Map std::map, returning a map to store all unique ID from all objects from all transa..." alt="" coords="681,5,824,32"/>
</map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="main_8cpp_a5675cb594d74aa1bf5e80233370ffd81_a5675cb594d74aa1bf5e80233370ffd81_icgraph.png" border="0" usemap="#main_8cpp_a5675cb594d74aa1bf5e80233370ffd81_a5675cb594d74aa1bf5e80233370ffd81_icgraph" alt=""/></div>
<map name="main_8cpp_a5675cb594d74aa1bf5e80233370ffd81_a5675cb594d74aa1bf5e80233370ffd81_icgraph" id="main_8cpp_a5675cb594d74aa1bf5e80233370ffd81_a5675cb594d74aa1bf5e80233370ffd81_icgraph">
<area shape="rect" id="node2" href="main_8cpp_a840291bc02cba5474a4cb46a9b9566fe.html#a840291bc02cba5474a4cb46a9b9566fe" title="main" alt="" coords="132,5,183,32"/>
</map>
</div>
</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="main_8cpp.html">main.cpp</a></li>
    <li class="footer">Generated on Tue Mar 13 2018 12:13:37 for C++ Software transactional Memory by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
